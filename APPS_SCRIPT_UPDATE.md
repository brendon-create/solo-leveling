# 🔧 Google Apps Script 更新指南

## ⚠️ 重要更新

您的 Google Sheet 可能已經有很多重複記錄（每次操作都新增一行）。

新版 Apps Script 改為：**每天只有一筆記錄，多次操作會更新同一筆**

---

## 🚀 更新步驟（5分鐘）

### 1. 打開 Apps Script 編輯器

1. 開啟您的 Google Sheet
2. 點擊 **擴充功能** → **Apps Script**
3. 應該會看到您之前的代碼

### 2. 替換為新代碼

1. **全選並刪除**舊代碼（`Command + A` → `Delete`）
2. **複製專案中的新代碼**：
   - 開啟 `google-apps-script.js` 檔案
   - 複製所有內容
3. **貼上到 Apps Script 編輯器**
4. 點擊 **儲存**（磁碟圖示或 `Command + S`）

### 3. 重新部署

1. 點擊 **部署** → **管理部署作業**
2. 找到現有的部署（版本1）
3. 點擊 **✏️ 編輯**
4. 在「新說明」欄位輸入：`版本2 - 每日更新模式`
5. 點擊 **版本** 下拉選單 → **新版本**
6. 點擊 **部署**

**注意**：Web App URL 不會改變，仍然是：
```
https://script.google.com/macros/s/AKfycbx8a65wx3pwmeVu4fqYQ1c6A9WVnjABkpv2Fx71a5H-BudTrqm51e8YGlS9Gul3LQ-p3w/exec
```

### 4. 測試

1. 回到應用，點擊任何任務
2. 等待 5 秒
3. 檢查 Google Sheet

**應該看到**：
- ✅ 今天的日期只有**一筆記錄**
- ✅ 包含「最後更新時間」欄位
- ✅ 多次操作會更新同一筆記錄

---

## 📊 新舊對比

### ❌ 舊版（問題）
```
2026-02-16 11:30:00 | 運動數據...
2026-02-16 11:30:04 | 運動數據...
2026-02-16 11:30:08 | 運動數據...
... 100筆記錄
```
結果：**每次操作都新增一行** → Sheet爆炸

### ✅ 新版（改進）
```
日期        | 最後更新      | 運動數據...
2026-02-16  | 11:30:08     | 最新狀態
```
結果：**每天只有一筆，多次更新** → 乾淨整齊

---

## 💡 關於感恩筆記

### 運作方式
1. **隨時編輯**：當天內可以隨時修改感恩筆記
2. **自動同步**：每次修改後5秒自動同步
3. **更新記錄**：同一天的記錄會被更新（不是新增）
4. **最終版本**：當天結束時，Google Sheet保存的是最後一次編輯的內容

### 例如
```
10:00 - 寫：「早上跑步很開心」→ 5秒後同步
14:00 - 改成：「早上跑步很開心，下午完成重要任務」→ 5秒後同步（更新同一筆）
22:00 - 加上：「早上跑步很開心，下午完成重要任務，晚上和朋友聚會」→ 最終版本

Google Sheet只有一筆，內容是22:00的最終版本
```

---

## 🧹 清理舊記錄（可選）

如果您的 Sheet 已經有很多重複記錄：

### 選項 A：手動刪除
1. 在 Google Sheet 中選擇重複的行
2. 右鍵 → 刪除行

### 選項 B：重新開始
1. 創建一個新的 Google Sheet
2. 部署新的 Apps Script
3. 在應用中更新 Sheet URL 和 Web App URL

### 選項 C：保留舊數據
1. 將當前工作表重命名為「歷史記錄」
2. 創建新工作表「每日記錄」
3. 修改 Apps Script 指向新工作表

---

## ⚙️ 在應用中設置

更新 Apps Script 後，在應用中：

1. 點擊右上角 **⚙️ 設定**
2. 確認 **Google Sheet URL** 正確
3. 輸入 **Apps Script Web App URL**：
   ```
   https://script.google.com/macros/s/AKfycbx8a65wx3pwmeVu4fqYQ1c6A9WVnjABkpv2Fx71a5H-BudTrqm51e8YGlS9Gul3LQ-p3w/exec
   ```
4. 點擊 **儲存**
5. 開始使用！

---

## 🎯 同步邏輯總結

### 操作流程
```
用戶點擊喝水按鈕
    ↓
本地立即更新（localStorage）
    ↓
設置5秒計時器
    ↓
如果5秒內又點擊 → 取消計時器，重新計時
    ↓
5秒後無新操作 → 發送到 Google Sheet
    ↓
Apps Script 檢查今天是否已有記錄
    ↓
有 → 更新該行 | 無 → 新增一行
```

### 結果
- ✅ **每天只有一筆記錄**
- ✅ **記錄會持續更新**（包含感恩筆記）
- ✅ **減少 API 調用**（省資源）
- ✅ **Sheet 保持簡潔**（100天 = 100筆記錄）

---

## 📝 欄位說明

新版增加了「最後更新時間」欄位，讓您知道該筆記錄最後一次同步的時間。

---

## ✅ 更新完成後

1. 清理（或忽略）舊的重複記錄
2. 開始正常使用
3. 每天應該只會產生一筆乾淨的記錄

需要協助？隨時告訴我！🚀
